# åœ¨çº¿OJåˆ¤é¢˜ç³»ç»Ÿ

## é¡¹ç›®ç®€ä»‹
**å¼€å‘è€…**ï¼šææ¬£ã€åˆ˜æœ”é£ã€åˆ˜ç‚  
**å­¦å¹´**ï¼š2023-2024a  
**è¯¾ç¨‹æ•™å¸ˆ**ï¼šç‹é¹ä¼Ÿ  
**æ ¸å¿ƒå®šä½**ï¼šé¢å‘ç¼–ç¨‹å­¦ä¹ /æŠ€æœ¯é¢è¯•åœºæ™¯çš„é«˜å¹¶å‘ä»£ç è¯„æµ‹å¹³å°  

---

## æ ¸å¿ƒåŠŸèƒ½
### ç”¨æˆ·ä¾§åŠŸèƒ½
- ğŸš€ **ä»£ç å®æ—¶è¯„æµ‹**  
  - æ”¯æŒJavaä»£ç æäº¤ï¼ˆè¯­æ³•æ£€æŸ¥â†’æ²™ç®±éš”ç¦»è¿è¡Œâ†’å¤šæµ‹è¯•ç”¨ä¾‹éªŒè¯ï¼‰
  - è¿”å›ç¼–è¯‘é”™è¯¯/è¿è¡Œç»“æœ/å†…å­˜&CPUæ¶ˆè€—æŒ‡æ ‡
- ğŸ” **æ™ºèƒ½é¢˜ç›®æ£€ç´¢**  
  - æ”¯æŒæ ‡ç­¾ç­›é€‰ã€éš¾åº¦åˆ†çº§ã€å…³é”®è¯æ¨¡ç³Šæœç´¢
- ğŸ“Š **æ•°æ®å¯è§†åŒ–**  
  - ç”¨æˆ·é€šè¿‡ç‡åˆ†æã€é¢˜ç›®çƒ­åº¦ç»Ÿè®¡ã€æäº¤è®°å½•æ—¶é—´è½´

### ç®¡ç†ä¾§åŠŸèƒ½
- âš™ï¸ **é¢˜ç›®å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†**  
  - Markdownå¯Œæ–‡æœ¬ç¼–è¾‘é¢˜ç›®æè¿°
  - æµ‹è¯•ç”¨ä¾‹æ‰¹é‡å¯¼å…¥/ç‰ˆæœ¬æ§åˆ¶
  - é¢˜ç›®è®¿é—®æƒé™åˆ†çº§æ§åˆ¶
- ğŸ›¡ï¸ **ç³»ç»Ÿå®‰å…¨ç›‘æ§**  
  - Dockeræ²™ç®±èµ„æºéš”ç¦»
  - æ¶æ„ä»£ç ç‰¹å¾æ£€æµ‹ï¼ˆASTé™æ€åˆ†æ+è¿è¡Œæ—¶è¡Œä¸ºç›‘æ§ï¼‰

---

## åˆ†å±‚æ¶æ„è¯´æ˜
### ç³»ç»Ÿåˆ†å±‚è®¾è®¡


### 1. ç”¨æˆ·ç•Œé¢å±‚ï¼ˆPresentation Layerï¼‰
- **æŠ€æœ¯æ ˆ**: 
  - Vue3 SPAï¼šæ„å»ºå“åº”å¼å•é¡µåº”ç”¨
  - Monaco Editorï¼šæä¾›ç±»IDEçš„ä»£ç ç¼–è¾‘å™¨ä½“éªŒ
  - Ant Design Vueï¼šä¼ä¸šçº§UIç»„ä»¶åº“
- **æ ¸å¿ƒèƒ½åŠ›**:
  - å®æ—¶ä»£ç ç¼–è¾‘ä¸è¯­æ³•é«˜äº®
  - äº¤äº’å¼é¢˜ç›®å±•ç¤ºä¸æäº¤
  - è¯„æµ‹ç»“æœå¯è§†åŒ–ï¼ˆé€šè¿‡å›¾è¡¨å±•ç¤ºæ—¶é—´/å†…å­˜æ¶ˆè€—ï¼‰

### 2. ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆBusiness Layerï¼‰
- **æŠ€æœ¯ç»„ä»¶**:
  - Spring Bootï¼šRESTful APIæœåŠ¡
  - æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQ/Kafkaï¼‰ï¼šå¼‚æ­¥ä»»åŠ¡è°ƒåº¦
  - åˆ¤é¢˜å¼•æ“ï¼šæ ¸å¿ƒè¯„æµ‹é€»è¾‘å¤„ç†å™¨
- **å…³é”®ç‰¹æ€§**:
  - åŸºäºä¼˜å…ˆçº§é˜Ÿåˆ—çš„ä»»åŠ¡è°ƒåº¦
  - è‡ªåŠ¨æ°´å¹³æ‰©å±•çš„åˆ¤é¢˜é›†ç¾¤
  - æ”¯æŒå¤šè¯­è¨€ï¼ˆJava/Python/C++ï¼‰çš„é€‚é…å™¨æ¨¡å¼

### 3. æ•°æ®æœåŠ¡å±‚ï¼ˆData Service Layerï¼‰
- **å­˜å‚¨ç³»ç»Ÿ**:
  - MySQLé›†ç¾¤ï¼ˆä¸»ä»å¤åˆ¶+åˆ†åº“åˆ†è¡¨ï¼‰ï¼šé¢˜ç›®/ç”¨æˆ·æ•°æ®å­˜å‚¨
  - Redisç¼“å­˜ï¼ˆClusteræ¨¡å¼ï¼‰ï¼šçƒ­ç‚¹æ•°æ®ç¼“å­˜ï¼ˆå¦‚æ’è¡Œæ¦œï¼‰
  - åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ï¼šæµ‹è¯•ç”¨ä¾‹/ä»£ç æ¨¡æ¿å­˜å‚¨
- **æ•°æ®æµ**:
  ```mermaid
  graph LR
    A[å…ƒæ•°æ®] --> MySQL
    B[æµ‹è¯•ç”¨ä¾‹] --> MinIO
    C[è¯„æµ‹ç»“æœ] --> MySQL
    D[å®æ—¶æ’è¡Œ] --> Redis
---

## æŠ€æœ¯é€‰å‹
### åç«¯æŠ€æœ¯æ ˆ
| æ¨¡å—           | æŠ€æœ¯æ–¹æ¡ˆ                              | ç‰ˆæœ¬       |
|----------------|---------------------------------------|------------|
| åŸºç¡€æ¡†æ¶       | Spring Boot 3.x                       | 3.1.5      |
| å®‰å…¨éš”ç¦»       | Docker + Java Security Manager        | 20.10.17   |
| æ•°æ®å­˜å‚¨       | MySQL 8 + ShardingSphere              | 5.3.2      |
| ç¼“å­˜åŠ é€Ÿ       | Redis 7 + Caffeine                    | 3.2.0      |
| æ¶ˆæ¯é€šä¿¡       | RabbitMQ                              | 3.12.0     |
| ä»£ç åˆ†æ       | ANTLR 4 + JavaParser                  | 4.13.0     |

### å‰ç«¯æŠ€æœ¯æ ˆ
| æ¨¡å—           | æŠ€æœ¯æ–¹æ¡ˆ                              | ç‰ˆæœ¬       |
|----------------|---------------------------------------|------------|
| æ ¸å¿ƒæ¡†æ¶       | Vue3 + Composition API                | 3.3.4      |
| ä»£ç ç¼–è¾‘       | Monaco Editor                         | 0.45.0     |
| çŠ¶æ€ç®¡ç†       | Vuex                                  | 4.1.0      |
| æ ·å¼ç»„ä»¶       | Ant Design Vue                        | 3.2.20     |
| å·¥ç¨‹åŒ–         | Vite 4 + TypeScript 5                 | 4.4.5      |

---

## éƒ¨ç½²è¦æ±‚
### ç¡¬ä»¶é…ç½®
| èŠ‚ç‚¹ç±»å‹       | æœ€ä½é…ç½®                | æ¨èé…ç½®                |
|----------------|-------------------------|-------------------------|
| åº”ç”¨æœåŠ¡å™¨     | 2æ ¸4G                   | 4æ ¸8Gï¼ˆDockeré›†ç¾¤ï¼‰     |
| æ•°æ®åº“æœåŠ¡å™¨   | 4æ ¸8G + 200GB SSD       | 8æ ¸16G + RAID10 SSD     |
| ç½‘ç»œå¸¦å®½       | 50Mbps                  | â‰¥100Mbpsï¼ˆBGPçº¿è·¯ï¼‰     |

### è½¯ä»¶ä¾èµ–
- Docker Engine 20.10+
- OpenJDK 17+
- Node.js 18.x LTS
- MySQL 8.x with InnoDB Cluster

---

## å…³é”®è®¾è®¡
### å®‰å…¨æ²™ç®±å®ç°
```java
// Dockeræ²™ç®±ç®¡ç†å™¨ç¤ºä¾‹ä»£ç 
public class DockerJudgeEnv {
    private DockerClient dockerClient;
    
    public ExecutionResult executeCode(Submission submission) {
        // 1. åˆ›å»ºä¸´æ—¶å®¹å™¨
        CreateContainerCmd cmd = dockerClient.createContainerCmd("openjdk:17")
            .withMemorySwap(0L)
            .withMemory(512 * 1024 * 1024L) // å†…å­˜é™åˆ¶512MB
            .withCpuShares(512); // CPUæƒé‡é™åˆ¶
        
        // 2. æ³¨å…¥å®‰å…¨ç­–ç•¥
        HostConfig hostConfig = new HostConfig()
            .withCapDrop("ALL")
            .withSecurityOpts(List.of("no-new-privileges"));
        cmd.withHostConfig(hostConfig);
        
        // 3. æ‰§è¡Œä»£ç å¹¶è·å–ç»“æœ
        // ...ï¼ˆçœç•¥å…·ä½“å®ç°ï¼‰
    }
}
```

### é«˜å¹¶å‘å¤„ç†
- **äºŒçº§ç¼“å­˜ç­–ç•¥**ï¼š
  ```plaintext
  ç”¨æˆ·è¯·æ±‚ â†’ Redisåˆ†å¸ƒå¼ç¼“å­˜ â†’ Caffeineæœ¬åœ°ç¼“å­˜ â†’ DBæŸ¥è¯¢
  ```
- **åŠ¨æ€é˜Ÿåˆ—åˆ†æµ**ï¼š
  ```mermaid
  graph LR
      A[æäº¤è¯·æ±‚] --> B{é˜Ÿåˆ—é•¿åº¦<100?}
      B -->|æ˜¯| C[å³æ—¶å¤„ç†é˜Ÿåˆ—]
      B -->|å¦| D[æ‰¹é‡å¤„ç†é˜Ÿåˆ—]
      C --> E[ä¼˜å…ˆè°ƒåº¦]
      D --> F[ç©ºé—²æ—¶æ®µå¤„ç†]
  ```

---

## å¿«é€Ÿå¼€å§‹
### æœ¬åœ°å¼€å‘æ¨¡å¼
```bash
# åç«¯æœåŠ¡
mvn clean install
java -jar -Dspring.profiles.active=dev target/oj-server.jar

# å‰ç«¯å¼€å‘
cd frontend
npm install
npm run dev -- --port 5173
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
# ä½¿ç”¨Docker Composeå¯åŠ¨æ ¸å¿ƒæœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# åˆå§‹åŒ–æ•°æ®åº“
mysql -h 127.0.0.1 -u root -p < init_schema.sql
```

---

## æ•…éšœå¤„ç†æŒ‡å—
| æ•…éšœç°è±¡               | æ’æŸ¥æ­¥éª¤                              | åº”æ€¥æ–¹æ¡ˆ                      |
|------------------------|---------------------------------------|-------------------------------|
| è¯„æµ‹æœåŠ¡æ— å“åº”         | 1. æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€<br>2. æŸ¥çœ‹RabbitMQé˜Ÿåˆ—å †ç§¯æƒ…å†µ | é‡å¯åˆ¤é¢˜å¼•æ“å®¹å™¨              |
| æ•°æ®åº“è¿æ¥è¶…æ—¶         | 1. éªŒè¯ä¸»ä»åŒæ­¥çŠ¶æ€<br>2. æ£€æŸ¥è¿æ¥æ± é…ç½®           | åˆ‡æ¢åªè¯»å‰¯æœ¬+é™æµ            |
| å†…å­˜æ³„æ¼               | 1. ç”ŸæˆHeap Dumpåˆ†æ<br>2. æ£€æŸ¥æœªå…³é—­çš„èµ„æºå¥æŸ„    | éš”ç¦»é—®é¢˜å®¹å™¨+è‡ªåŠ¨æ¨ªå‘æ‰©å±•     |
| æ¶æ„ä»£ç æ”»å‡»            | 1. æ£€æŸ¥æ²™ç®±é€ƒé€¸æ—¥å¿—<br>2. åˆ†æç³»ç»Ÿè°ƒç”¨è®°å½•         | å°ç¦IP+å¢å¼ºå®‰å…¨ç­–ç•¥          |

---

## å‚è€ƒèµ„æº
- [Hcode Online Judgeæ¶æ„è®¾è®¡](https://github.com/HimitZH/HOJ)
- é’å²›å¤§å­¦OJç³»ç»Ÿå®ç°æ–¹æ¡ˆ
- Javaå®‰å…¨æ²™ç®±æœ€ä½³å®è·µ

[![License](https://img.shields.io/badge/License-Apache_2.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
```
